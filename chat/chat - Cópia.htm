
<html>
    <link rel="stylesheet" href="./chat/jquery-ui-1.9.2.custom.min.css">
    <script type="text/javascript" src="./chat/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="./chat/jquery-ui-1.9.2.custom.min.js"></script>
    <link type="text/css" href="./chat/jquery.ui.chatbox.css" rel="stylesheet">
    <script type="text/javascript" src="./chat/jquery.ui.chatbox.js"></script>
    <script type="text/javascript" src="./chat/chatboxManager.js"></script>
    
    <script type="text/javascript">



jQuery(document).ready(function(){
 
      cliente = 'renan';

      var broadcastMessageCallback = function(from, msg) {
          
        jQuery("#"+from).chatbox("option", "boxManager").addMsg(cliente, msg);


jQuery.ajax({ 
        type: 'GET',
        url: "http://localhost:8080/nomuschat/chat/recebeMensagem?remetente=" + cliente + "&destinatario=" + from + "&mensagem="+ msg ,
        dataType: 'jsonp', 
        jsonp: false,
	jsonpCallback: "jsonpCallback",
        success: function(data) { 
            console.log(data);
        }
    });



      }


      chatboxManager.init({messageSent : broadcastMessageCallback});


setInterval(verificaExistenciaNovasMensagens, 5000);


function verificaExistenciaNovasMensagens(){

    jQuery.ajax({ 
        type: 'GET',
        url: "http://localhost:8080/nomuschat/chat/verificaExistenciaNovasMensagens?cliente=" + cliente + "&login=renan&senha=teste" ,
        dataType: 'jsonp', 
        jsonp: false,
	jsonpCallback: "jsonpCallback",
        success: function(data) { 
            jQuery.each(data.list, function(i, item){


               chatboxManager.addBox(item.remetente, {dest: item.remetente, title: item.remetente , first_name: item.remetente, last_name: '' });
               jQuery("#"+item.remetente).chatbox("option", "boxManager").addMsg(item.remetente, item.mensagem);


 	    });
        }
    });
}

});
 </script>
  </head>
  <body>
  
<div id='chat_div' >  </div>


</body></html>